!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("index",["exports"],e):e((t=t||self).index={})}(this,(function(t){"use strict";t.imSearch=class{constructor(t,e){this.select=t,this.searchTimeout=e.searchTimeout||750,this.openState=!1,this.value=null,this.keyboardEvents=0!=e.keyboardEvents,this.ajaxItems=e.ajaxItems||!1,this.dynamicAjax=e.dynamicAjax||!1,(this.ajaxItems||this.dynamicAjax)&&(this.responePath=this.select.getAttribute("data-response-path"),this.responseMessage=null),this.input=this.select.querySelector("[data-input]"),this.listContainer=this.select.querySelector("[data-list-container]"),this.listItems=[],this.btnsOpen=this.select.querySelectorAll("[data-open=true]"),this.init()}init(){this.focusItem=null,this.select.querySelectorAll("[data-list-item]").forEach((t=>{this.listItems.push(t)}));let t=null;this.ajaxItems&&this._fetch(),this._inputListenerOnInput=e=>{clearTimeout(t),this.open(),t=setTimeout((()=>{this.value=this.input.value,this.dynamicAjax?(this._fetch(),this.loadItems()):this.search()}),this.searchTimeout)},this._inputListenerOnFocus=t=>{this.ajaxItems&&(this.loadItems(),this.ajaxItems=!1),this.open()},this._inputListenerOnBlur=t=>{this.close()},this._listItemListenerOnClick=t=>{t.preventDefault(),this.selectItem(t.target)},this._btnsOpenListenerOnClick=t=>{t.preventDefault(),this.openState?this.close():this.open()},this.input.addEventListener("input",this._inputListenerOnInput),this.input.addEventListener("focus",this._inputListenerOnFocus),this.select.addEventListener("blur",this._inputListenerOnBlur),this.listItems.forEach((t=>{t.addEventListener("click",this._listItemListenerOnClick)})),this.btnsOpen.forEach((t=>{t.addEventListener("click",this._btnsOpenListenerOnClick)})),document.addEventListener("click",(t=>{const e=t.target;this.select.contains(e)||this.close()})),document.addEventListener("keydown",(t=>{if(this.openState&&this.keyboardEvents&&!t.defaultPrevented)switch(t.key){case"ArrowDown":t.preventDefault(),this.focusNext();break;case"ArrowUp":t.preventDefault(),this.focusPrev();break;case"Enter":t.preventDefault(),this.Enter()}}))}_fetch(){if(this.formData=new FormData,this.dataset=this.select.dataset,this.dataset.value=this.value,this.dataset)for(const t of Object.keys(this.dataset))t&&this.formData.append(t,this.dataset[t])}destroy(){this.input.removeEventListener("input",this._inputListenerOnInput),this.input.removeEventListener("focus",this._inputListenerOnFocus),this.select.removeEventListener("blur",this._inputListenerOnBlur),this.listItems.forEach((t=>{t.removeEventListener("click",this._listItemListenerOnClick)})),this.btnsOpen.forEach((t=>{t.removeEventListener("click",this._btnsOpenListenerOnClick)}))}focusNext(){this.focusItem.classList.remove("focus"),this.focusItem.nextElementSibling?this.focusItem=this.focusItem.nextElementSibling:this.focusItem=this.listItems[0],this.focusItem.classList.add("focus")}focusPrev(){this.focusItem.classList.remove("focus"),this.focusItem.previousElementSibling?this.focusItem=this.focusItem.previousElementSibling:this.focusItem=this.listItems[this.listItems.length-1],this.focusItem.classList.add("focus")}Enter(){this.focusItem.click()}loadItems(){fetch(this.responePath,{method:"GET"}).then((t=>t.json())).then((t=>{t.result?t.message&&(this.responseMessage=t.message,this._generateItems(),this.focus()):console.log(t.message)})).catch((t=>console.error(t)))}_generateItems(){if(null!=this.responseMessage){let t="";this.listContainer.innerHTML="",this.responseMessage.forEach(((e,s)=>{t+=`<a class="b-im-complete__result-item" data-list-item="true">\n\t\t\t\t\t<span data-item-value="true" id="${e.id}">${e.value}</span></a>`})),this.listContainer.insertAdjacentHTML("afterbegin",t),this.destroy(),this.init()}}search(){let t=!1;this.listItems.forEach((e=>{e.querySelector("[data-item-value=true]").innerText.toLowerCase().includes(this.value.toLowerCase())?(e.style.display="",t||(this.focus(),t=!0)):e.style.display="none"})),this.focus()}open(){this.openState||(this.select.classList.add("opened"),this.openState=!0,this.focus())}close(){this.openState&&(this.select.classList.remove("opened"),this.openState=!1)}selectItem(t){this.value=t.querySelector("[data-item-value]").innerText,this.input.value=this.value,this.close()}focus(){if(this.select.querySelector(".focus")&&this.select.querySelector(".focus").classList.remove("focus"),this.select.querySelector("[data-list-item]")){let t=!1;this.select.querySelectorAll("[data-list-item]").forEach((e=>{"none"==e.style.display||t||(e.classList.add("focus"),t=!0)})),t&&(this.focusItem=this.select.querySelector(".focus"))}}},Object.defineProperty(t,"__esModule",{value:!0})}));